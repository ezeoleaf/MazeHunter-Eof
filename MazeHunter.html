<!DOCTYPE html> 
<html lang="es"> 
<head> 
	<title>MazeHunter</title>
	<script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="jquery.timer.js" type="text/javascript"></script>
	<link href="MazeHunterStyle.css" rel="stylesheet" type="text/css" />
</head>
<script>

var initialText = "Bienvenidos a MazeHunter";
characterPos_x = 250;
characterPos_y = 245;
characterSpeed = 3;
varTop = 2;
varBottom = 2;
varRight = 2;
varLeft = 2;
keyPressed = 0;
characterNumber = 1;
keyUp = 0;
zoneNumber = 23;
var zones, objects, characterSizes;

function initializeData()
{
	//Objects va a tener los objetos que pueden aparecer en un mapa.
	//Ej: (nombre,pos_x,pos_y,width, height,0 o 1); //0 representa que se tiene que poner antes que el character en el html y 1 desp del character
	objects = {
		"1" : "creeper1.png,80,110,65,120,0",
		"2" : "tree1.png,400,350,110,125,1",
		"3" : "tree2.png,50,300,110,125,1",
		//"4" : "tree3.png,80,300,65,120,1",
		"5" : "tree4.png,480,350,110,125,1",
		"6" : "tree5.png,400,50,110,125,1",
		"11" : "endFlag.png,225,0,100,50,0",
	}

	characterSizes = {
		"1" : "b,42,55,l,42,55,r,42,55,t,42,57",
		"2" : "b,42,53,l,42,54,r,42,54,t,42,52",
	}
	
	//Zones = (top, left, bottom, right, objectId)
	zones = {
		"zone1" : "0,0,1,1,0",
		"zone2" : "0,1,0,1,0",
		"zone3" : "2,1,0,1,11",
		"zone4" : "0,1,1,1,0",
		"zone5" : "0,1,1,0,0",
		"zone6" : "1,0,1,0,0",
		"zone7" : "0,0,1,1,0",
		"zone8" : "0,1,1,0,0",
		"zone9" : "1,0,1,1,0",
		"zone10" : "1,1,1,0,0",
		"zone11" : "1,1,1,1,0",
		"zone12" : "1,1,1,1,0",
		"zone13" : "1,1,0,1,0",
		"zone14" : "1,1,1,1,0",
		"zone15" : "1,1,1,1,0",
		"zone16" : "1,0,1,0,0",
		"zone17" : "1,0,1,1,0",
		"zone18" : "0,1,1,1,0",
		"zone19" : "1,1,0,1,0",
		"zone20" : "1,1,1,0,0",
		"zone21" : "1,1,1,1,0",
		"zone22" : "1,1,0,1,0",
		"zone23" : "1,1,1,1,0",
		"zone24" : "0,1,1,1,0",
		"zone25" : "1,1,1,1,0",
		"zone26" : "1,0,1,1,0",
		"zone27" : "0,1,1,1,0",
		"zone28" : "1,1,0,0,0",
		"zone29" : "1,0,1,1,0",
		"zone30" : "1,1,0,0,0",
		"zone31" : "1,0,0,1,0",
		"zone32" : "1,1,0,1,0",
		"zone33" : "0,1,0,0,0",
		"zone34" : "1,0,0,1,0",
		"zone35" : "0,1,0,0,0",
	}
}

function newGame()
{
	characterNumber = (1 + Math.floor(Math.random() * 2));
	loadMap(zoneNumber, 5);

}

function getConfigZone(numberOfZone)
{
	var nameOfZone = 'zone'+numberOfZone;
	var fullConfig = zones[nameOfZone];
	var vConfig = fullConfig.split(',');
	return vConfig;
}

function getConfigObject(numberOfObject)
{
	var fullConfigO = objects[numberOfObject];
	var vConfigO = fullConfigO.split(',');
	return vConfigO;
}

function stopCharacter()
{
	switch(keyUp)
	{
		case 1:
			nextMove = 't-'+varTop;
			avatar = 'url("Img/Characters/Character'+characterNumber+'/'+nextMove+'.png")';
			break;
		case 2:
			nextMove = 'b-'+varBottom;
			avatar = 'url("Img/Characters/Character'+characterNumber+'/'+nextMove+'.png")';
			break;
		case 3:
			nextMove = 'l-'+varLeft;
			avatar = 'url("Img/Characters/Character'+characterNumber+'/'+nextMove+'.png")';
			break;
		case 4:
			nextMove = 'r-'+varRight;
			avatar = 'url("Img/Characters/Character'+characterNumber+'/'+nextMove+'.png")';
			break;
		default:
			break;
	}
}

function loadMap(numberOfNextZone, sideCharacter)
{
	var vConfigNextZone = getConfigZone(numberOfNextZone);

	//Acomodar separando por bordes, sombras, y middles
	borderLeftTopHtml = '<div id="borderLeftTop"></div>';
	shadowLeftTopHtml = '<div id="shadowTop"></div>';
	borderRightTopHtml = '<div id="borderRightTop"></div>';
	shadowLeftBottomHtml = '<div id="shadowBottom"></div>';
	characterPlayerHtml = '<div id="playerCharacter"></div>';
	borderLeftBottomHtml = '<div id="borderLeftBottom"></div>';
	borderRightBottomHtml = '<div id="borderRightBottom"></div>';
	
	if(vConfigNextZone[0] == 0)
	{
		borderTopMiddleHtml = '<div id="borderTopMiddle"></div>';
	}
	else
	{
		borderTopMiddleHtml = '';
	}

	if(vConfigNextZone[1] == 0)
	{
		borderLeftMiddleHtml = '<div id="borderLeftMiddle"></div>';
		shadowLeftMiddleHtml = '<div id="shadowMiddle"></div>';
	}
	else
	{
		borderLeftMiddleHtml = '';
		shadowLeftMiddleHtml = '';
	}

	if(vConfigNextZone[2] == 0)
	{
		borderBottomMiddleHtml = '<div id="borderBottomMiddle"></div>';
		
	}
	else
	{
		borderBottomMiddleHtml = '';
	}
	
	if(vConfigNextZone[3] == 0)
	{
		borderRightMiddleHtml = '<div id="borderRightMiddle"></div>';
	}
	else
	{
		borderRightMiddleHtml = '';
	}

	var objectControlSide;
	if(vConfigNextZone[4] != 0)
	{
		var vConfigNewObject = getConfigObject(vConfigNextZone[4]);
		objectAvatar = 'url("Img/'+vConfigNewObject[0]+'")';
		objectPos_x = parseInt(vConfigNewObject[1]);
		objectPos_y = parseInt(vConfigNewObject[2]);
		objectWidth = parseInt(vConfigNewObject[3]);
		objectHeight = parseInt(vConfigNewObject[4]);
		objectControlSide = parseInt(vConfigNewObject[5]);
		objectHtml = '<div class="object" id="object'+vConfigNextZone[4]+'"></div>';
	}
	else
	{
		objectHtml = '';
	}
	
	if(objectControlSide == 0)
	{
		$('#court').html(borderLeftTopHtml+shadowLeftMiddleHtml+borderRightTopHtml+shadowLeftTopHtml+shadowLeftBottomHtml+borderTopMiddleHtml+objectHtml+characterPlayerHtml+borderLeftBottomHtml+borderRightBottomHtml+borderLeftMiddleHtml+borderRightMiddleHtml+borderBottomMiddleHtml);
	}
	else
	{
		$('#court').html(borderLeftTopHtml+shadowLeftMiddleHtml+borderRightTopHtml+shadowLeftTopHtml+shadowLeftBottomHtml+borderTopMiddleHtml+characterPlayerHtml+borderLeftBottomHtml+borderRightBottomHtml+borderLeftMiddleHtml+borderRightMiddleHtml+borderBottomMiddleHtml+objectHtml);
	}
	
	var sideLetter;
	switch(sideCharacter)
	{
		case 1:
			sideLetter = 't';
			characterPos_x = 250;
			characterPos_y = 470;
			break;
		case 2:
			sideLetter = 'b';
			characterPos_x = 250;
			characterPos_y = 15;
			break;
		case 3:
			sideLetter = 'l';
			characterPos_x = 490;
			characterPos_y = 245;
			break;
		case 4:
			sideLetter = 'r';
			characterPos_x = 15;
			characterPos_y = 245;
			break;
		case 5:
			sideLetter = 'b';
			break;
	}
	if(vConfigNextZone[4] != 0)
	{
		$('#object'+vConfigNextZone[4]).css('background-image', objectAvatar);
		$('#object'+vConfigNextZone[4]).css('left', objectPos_x);
		$('#object'+vConfigNextZone[4]).css('top', objectPos_y);
		$('#object'+vConfigNextZone[4]).css('width', objectWidth);
		$('#object'+vConfigNextZone[4]).css('height', objectHeight);
	}
	avatar = 'url("Img/Characters/Character'+characterNumber+'/'+sideLetter+'-2.png")';
	$('#playerCharacter').css('left', characterPos_x);
	$('#playerCharacter').css('top', characterPos_y);
	$('#playerCharacter').css('background-image', avatar);
	zoneNumber = numberOfNextZone;
}

//Funcion que me devuelve el alto y ancho de un character, todavia no en uso por que por lo pronto no se necesita
function getWidthAndHeight(numberOfCharacter, sideCharacter)
{
	var stringCharacter = characterSizes[numberOfCharacter];
	var letterToFind, widthCharacter, heightCharacter;
	var vStringCharacter = stringCharacter.split(',');
	switch(sideCharacter)
	{
		case 1:
			letterToFind = 't';
			break;
		case 2:
			letterToFind = 'b';
			break;
		case 3:
			letterToFind = 'l';
			break;
		case 4:
			letterToFind = 'r';
			break;
	}
	if($.inArray(letterToFind,vStringCharacter) != -1)
	{
		widthCharacter = vStringCharacter[(($.inArray(letterToFind,vStringCharacter)) + 1)];
		heightCharacter = vStringCharacter[(($.inArray(letterToFind,vStringCharacter)) + 2)];
	}
	var vPosReturn = [widthCharacter,heightCharacter];
	return vPosReturn;
}

function changeMap(numberOfZone, side)
{
	if(numberOfZone == 11 || numberOfZone == 21 || numberOfZone == 15 || numberOfZone == 25)
	{
		var moveIn = 0;
		//Zonas donde se da vuelta el mapa
		switch(side)
		{
			case 1:
				nextZone = numberOfZone - 5;
				moveIn = 1;
				break;
			case 2:
				nextZone = numberOfZone + 5;
				moveIn = 1;
				break;
		}
		if(moveIn == 0)
		{
			if(numberOfZone == 11)
			{
				switch(side)
				{
					case 3:
						nextZone = 15;
						break;
					case 4:
						nextZone = numberOfZone + 1;
						break;
				}
			}
			if(numberOfZone == 21)
			{
				switch(side)
				{
					case 3:
						nextZone = 25;
						break;
					case 4:
						nextZone = numberOfZone + 1;
						break;
				}
			}
			if(numberOfZone == 15)
			{
				switch(side)
				{
					case 3:
						nextZone = numberOfZone - 1;
						break;
					case 4:
						nextZone = 11;
						break;
				}
			}
			if(numberOfZone == 25)
			{
				switch(side)
				{
					case 3:
						nextZone = numberOfZone - 1;
						break;
					case 4:
						nextZone = 21;
						break;
				}
			}
		}
	}
	else
	{
		switch(side)
		{
			case 1:
				nextZone = numberOfZone - 5;
				break;
			case 2:
				nextZone = numberOfZone + 5;
				break;
			case 3:
				nextZone = numberOfZone - 1;
				break;
			case 4:
				nextZone = numberOfZone + 1;
				break;
		}
	}

	loadMap(nextZone, side);

}

//Devuelve false cuando no puede seguir
function limitMapControl(side)
{
	var vConfigZone = getConfigZone(zoneNumber);
	switch(side)
	{
		case 1:
			if(vConfigZone[0] == 0)
			{
				if(characterPos_x > 225 && characterPos_x < 325)
				{
					if((characterPos_y - characterSpeed) < 100 )
					{
						return false;
					}
				}
			}
			else if(vConfigZone[0] == 1)
			{
				if((characterPos_y - characterSpeed) < 10)
				{
					changeMap(zoneNumber, side);
				}
			}
			if((characterPos_x < 225 || characterPos_x >= 290))
			{
				if((characterPos_y - characterSpeed) < 190)
				{
					return false;
				}
			}
			break;
		case 2:
			if(vConfigZone[2] == 0)
			{
				if(characterPos_x >= 225 && characterPos_x < 325)
				{
					if((characterPos_y + characterSpeed) > 415 )
					{
						return false;
					}
				}
			}
			else if(vConfigZone[2] == 1)
			{
				if((characterPos_y + characterSpeed) > 495)
				{
					changeMap(zoneNumber, side);
				}
			}
			if((characterPos_x < 225 || characterPos_x >= 290))
			{
				if((characterPos_y + characterSpeed) > 290)
				{
					return false;
				}
			}
			break;
		case 3:
			if(vConfigZone[1] == 0)
			{
				if(characterPos_y > 190 && characterPos_y < 325)
				{
					if((characterPos_x - characterSpeed) < 120 )
					{
						return false;
					}
				}
			}
			else if(vConfigZone[1] == 1)
			{
				if((characterPos_x - characterSpeed) < 10)
				{
					changeMap(zoneNumber, side);
				}
			}
			if((characterPos_y <= 180 || characterPos_y >= 295))
			{
				if((characterPos_x - characterSpeed) < 225)
				{
					return false;
				}
			}
			break;
		case 4:
			if(vConfigZone[3] == 0)
			{
				if(characterPos_y > 190 && characterPos_y < 325)
				{
					if((characterPos_x + characterSpeed) > 400 )
					{
						return false;
					}
				}
			}
			else if(vConfigZone[3] == 1)
			{
				if((characterPos_x + characterSpeed) > 495)
				{
					changeMap(zoneNumber, side);
				}
			}
			if((characterPos_y <= 180 || characterPos_y >= 295))
			{
				if((characterPos_x + characterSpeed) > 290)
				{
					return false;
				}
			}
			break;
	}
	return true;
}

function moveCharacter()
{
	switch(keyPressed)
	{
		case 1:
			if(varTop == 3)
			{
				varTop = 0;
			}
			varTop++;
			if(limitMapControl(keyPressed))
			{
				characterPos_y -= characterSpeed;
			}
			nextMove = 't-'+varTop;
			//avatar = 'url("Img/Characters/Character'+characterNumber+'/'+nextMove+'.png")';
			avatar = 'url("Img/Characters/Character'+characterNumber+'/t.gif")';
			break;
		case 2:
			if(varBottom == 3)
			{
				varBottom = 0;
			}
			varBottom++;
			if(limitMapControl(keyPressed))
			{
				characterPos_y += characterSpeed;	
			}
			nextMove = 'b-'+varBottom;
			//avatar = 'url("Img/Characters/Character'+characterNumber+'/'+nextMove+'.png")';
			avatar = 'url("Img/Characters/Character'+characterNumber+'/b.gif")';
			break;
		case 3:
			if(varLeft == 3)
			{
				varLeft = 0;
			}
			varLeft++;
			if(limitMapControl(keyPressed))
			{
				characterPos_x -= characterSpeed;
			}
			nextMove = 'l-'+varLeft;
			avatar = 'url("Img/Characters/Character'+characterNumber+'/'+nextMove+'.png")';
			avatar = 'url("Img/Characters/Character'+characterNumber+'/l.gif")';
			break;
		case 4:
			if(varRight == 3)
			{
				varRight = 0;
			}
			varRight++;
			if(limitMapControl(keyPressed))
			{
				characterPos_x += characterSpeed;
			}
			nextMove = 'r-'+varRight;
			avatar = 'url("Img/Characters/Character'+characterNumber+'/r.gif")';
			break;
	}
}

$(document).ready(function()
{
	
	initializeData();
	newGame();

	var timer = $.timer(function(){

		if(keyPressed != 0)
		{
			moveCharacter();
		}
		else
		{
			stopCharacter();
		}

		$('#playerCharacter').css('left', characterPos_x);
		$('#playerCharacter').css('top', characterPos_y);
		$('#playerCharacter').css('background-image', avatar);

	}, 20, true);

	/*
	KeyPressed
	1 - Arriba
	2 - Abajo
	3 - Izquierda
	4 - Derecha
	*/
	$('body').keydown(function() 
	{
		switch(event.which) {
			//Flecha arriba
			case 38:
				keyPressed = 1;
				break;
			//Flecha abajo
			case 40:
				keyPressed = 2;
				break;
			//Flecha izquierda
			case 37:
				keyPressed = 3;
				break;
			//Flecha derecha
			case 39:
				keyPressed = 4;
				break;
			// 32 responde a la tecla espacio que dispara
			/*case 32:
				if(winner == 0){
					if(shot < 5){
						shot++;
						cantOfShots++;
						prevHtml = $('#court').html();
						positionPlayerTank = $('#playerTank').position();
						//Agregar la aparicion del shot segun los grados
						posTankBall = getLeftAndTop(rotation);
						var vPosTankBall = posTankBall.split('/--/');
						posTankBall_x = positionPlayerTank.left + parseInt(vPosTankBall[0]);
						posTankBall_y = positionPlayerTank.top + parseInt(vPosTankBall[1]);
						ballString = '<div id="ball'+cantOfShots+'" class="ball" style="left: '+posTankBall_x+'px;top: '+posTankBall_y+'px;"></div>';
						$('#court').html(prevHtml + ballString);
						vShot.push(cantOfShots);
					}
				}
				break;
			*/
		}
	});

	$('body').keyup(function() 
	{
		switch(event.which) {
			// 38 responde a la flecha para arriba
			case 38:
				keyUp = 1;
				if(keyPressed == 1)
				{
					keyPressed = 0;	
				}
				break;
			//Flecha abajo
			case 40:
				keyUp = 2;
				if(keyPressed == 2)
				{
					keyPressed = 0;	
				}
				break;
			//Flecha izquierda
			case 37:
				keyUp = 3;
				if(keyPressed == 3)
				{
					keyPressed = 0;	
				}
				break;
			//Flecha derecha
			case 39:
				keyUp = 4;
				if(keyPressed == 4)
				{
					keyPressed = 0;	
				}
				break;
			//90 responde a 'z', gira el tanque
		}
	});

});
</script>
<body>
	<!--div id="headCourt">
		<div id="peopleDiv">
			<b><span class="peopleServedText">Personas Atendidas</span>
			<br />
			<span id="peopleServedValue" class="peopleServedText"></span></b>
		</div>
		<div id="reset">
			<input type="button" id="btnReset" name="reset" value="Reset"/>
		</div>
		<div id="levelDiv">
			<b><span class="levelText" align="center">Nivel</span>
			<br />
			<span id="levelValue" class="levelText"></span></b>
		</div>
	</div-->
	<div id="court">
		<div id="borderLeftTop">
		</div>
		<div id="borderRightTop">
		</div>
		<div id="borderLeftBottom">
		</div>
		<div id="borderRightBottom">
		</div>
	</div>
	<div id="textWinOrLose"><span></span></div>
</body> 
</html>